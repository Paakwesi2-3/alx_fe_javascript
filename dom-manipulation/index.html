<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dynamic Quote Generator with Category Filter</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    #quotes { margin-top: 1em; }
    .quote { border: 1px solid #ccc; padding: 1em; margin-bottom: 1em; border-radius: 5px; }
    .category { font-size: 0.9em; color: #555; }
    #addQuoteForm { margin-top: 2em; }
    label { display: block; margin-top: 0.5em; }
    select, input, textarea { width: 100%; padding: 0.5em; margin-top: 0.2em; }
    button { margin-top: 1em; padding: 0.5em 1em; }
  </style>
</head>
<body>
  <h1>Dynamic Quote Generator</h1>

  <label for="categoryFilter">Filter by Category:</label>
  <select id="categoryFilter"></select>

  <div id="quotes"></div>

  <form id="addQuoteForm">
    <h2>Add a New Quote</h2>
    <label for="quoteText">Quote:</label>
    <textarea id="quoteText" required></textarea>
    <label for="quoteAuthor">Author:</label>
    <input type="text" id="quoteAuthor" required>
    <label for="quoteCategory">Category:</label>
    <input type="text" id="quoteCategory" required>
    <button type="submit">Add Quote</button>
  </form>

  <script>
    // --- Storage Keys ---
    const QUOTES_KEY = 'quotes';
    const CATEGORY_FILTER_KEY = 'selectedCategory';

    // --- Initial Data ---
    const defaultQuotes = [
      { text: "The best way to get started is to quit talking and begin doing.", author: "Walt Disney", category: "Motivation" },
      { text: "Life is what happens when you're busy making other plans.", author: "John Lennon", category: "Life" },
      { text: "Success is not in what you have, but who you are.", author: "Bo Bennett", category: "Success" },
      { text: "The only limit to our realization of tomorrow is our doubts of today.", author: "Franklin D. Roosevelt", category: "Motivation" }
    ];

    // --- Utility Functions ---
    function getQuotes() {
      const stored = localStorage.getItem(QUOTES_KEY);
      return stored ? JSON.parse(stored) : defaultQuotes.slice();
    }

    function saveQuotes(quotes) {
      localStorage.setItem(QUOTES_KEY, JSON.stringify(quotes));
    }

    function getSelectedCategory() {
      return localStorage.getItem(CATEGORY_FILTER_KEY) || 'all';
    }

    function setSelectedCategory(category) {
      localStorage.setItem(CATEGORY_FILTER_KEY, category);
    }

    // --- Populate Categories ---
    function populateCategories() {
      const quotes = getQuotes();
      const categories = Array.from(new Set(quotes.map(q => q.category))).sort();
      const filter = document.getElementById('categoryFilter');
      filter.innerHTML = '<option value="all">All Categories</option>';
      categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        filter.appendChild(option);
      });
      // Restore last selected filter
      filter.value = getSelectedCategory();
    }

    // --- Filter and Display Quotes ---
    function filterQuotes() {
      const selected = document.getElementById('categoryFilter').value;
      setSelectedCategory(selected);
      const quotes = getQuotes();
      const filtered = selected === 'all'
        ? quotes
        : quotes.filter(q => q.category === selected);
      displayQuotes(filtered);
    }

    function displayQuotes(quotes) {
      const container = document.getElementById('quotes');
      if (quotes.length === 0) {
        container.innerHTML = '<p>No quotes found for this category.</p>';
        return;
      }
      container.innerHTML = quotes.map(q => `
        <div class="quote">
          <div>"${q.text}"</div>
          <div>- <strong>${q.author}</strong></div>
          <div class="category">[${q.category}]</div>
        </div>
      `).join('');
    }

    // --- Add Quote ---
    function addQuote(event) {
      event.preventDefault();
      const text = document.getElementById('quoteText').value.trim();
      const author = document.getElementById('quoteAuthor').value.trim();
      const category = document.getElementById('quoteCategory').value.trim();
      if (!text || !author || !category) return;

      const quotes = getQuotes();
      quotes.push({ text, author, category });
      saveQuotes(quotes);

      // Update categories and filter if new category is added
      populateCategories();
      // If the new quote's category is currently selected, show it
      if (getSelectedCategory() === 'all' || getSelectedCategory() === category) {
        filterQuotes();
      } else {
        // Otherwise, keep current filter
        filterQuotes();
      }

      // Reset form
      event.target.reset();
    }

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
      // Populate categories and set filter
      populateCategories();
      filterQuotes();

      // Attach event listeners
      document.getElementById('categoryFilter').addEventListener('change', filterQuotes);
      document.getElementById('addQuoteForm').addEventListener('submit', addQuote);
    });
  </script>
</body>
</html>